# Stage 2 å¥–åŠ±å‡½æ•°ä¼˜åŒ–æŠ¥å‘Š

**æ—¥æœŸ**: 2025-12-08  
**è®­ç»ƒè¿è¡Œ**: `Dcmm_Catch_seed42/2025-12-08/00:39:42`  
**é—®é¢˜ç±»å‹**: å¥–åŠ±å‡½æ•°æ•°å€¼ç¨³å®šæ€§ & æˆåŠŸæ¡ä»¶é€»è¾‘é”™è¯¯

---

## ğŸ“Š è®­ç»ƒæ—¥å¿—åˆ†æç»“æœ

### åŸå§‹æŒ‡æ ‡

| æŒ‡æ ‡ | èµ·å§‹å€¼ | æœ€ç»ˆå€¼ | æœ€ä½³å€¼ | è¯„ä»· |
|------|--------|--------|--------|------|
| Episode Reward | -15,458 | -349,346 | **-3,095.68** | âš ï¸ æåº¦ä¸ç¨³å®š |
| Success Rate | 81.25% | 83.41% | 89.05% | âœ… ç¨³å®š |
| Critic Loss | 0.2449 | 0.0054 | - | âœ… æ­£å¸¸æ”¶æ•› |
| Episode Length | 103.1 | 107.9 | 113.1 | âœ… æ­£å¸¸ |

### å…³é”®å‘ç°

å¥–åŠ±å€¼åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­å‡ºç°æç«¯æ³¢åŠ¨ï¼š
- æœ€ä½³: **-3,095**
- æœ€å·®: **-265,242,099,712** (è´Ÿ2650äº¿!)

å°½ç®¡æˆåŠŸç‡ç¨³å®šåœ¨ 83%ï¼Œä½†å¥–åŠ±çˆ†ç‚¸å¯¼è‡´è®­ç»ƒä¿¡å·ä¸ç¨³å®šã€‚

---

## ğŸ”´ å‘ç°çš„é—®é¢˜

### é—®é¢˜1: `reward_impact` æƒ©ç½šçˆ†ç‚¸ (æœ€ä¸¥é‡)

**ä½ç½®**: `RewardManagerStage2.py` Line 207-219

**åŸä»£ç **:
```python
reward_impact = -6.0 * (np.exp(5.0 * max(0, impact_speed - 0.3)) - 1.0)
```

**é—®é¢˜åˆ†æ**:
| é€Ÿåº¦ (m/s) | åŸæƒ©ç½šå€¼ |
|------------|----------|
| 0.3 | 0 |
| 0.5 | -10.3 |
| 1.0 | **-386** |
| 1.5 | **-14,520** |
| 2.0 | **-550,000** |

é«˜é€Ÿç¢°æ’æ—¶æŒ‡æ•°å‡½æ•°çˆ†ç‚¸ï¼Œå•æ­¥æƒ©ç½šå¯è¾¾æ•°åä¸‡ã€‚

**ä¿®å¤æ–¹æ¡ˆ**:
```python
raw_impact_penalty = -6.0 * (np.exp(5.0 * max(0, impact_speed - 0.3)) - 1.0)
reward_impact = max(-30.0, raw_impact_penalty)  # æ·»åŠ ä¸‹é™
```

---

### é—®é¢˜2: `reward_grasp` é«˜åŠ›æƒ©ç½šæ— ä¸‹é™

**ä½ç½®**: `RewardManagerStage2.py` Line 200-202

**åŸä»£ç **:
```python
reward_grasp = 5.0 - 2.0 * (total_contact_force - force_threshold_high)
```

**é—®é¢˜åˆ†æ**:
- å½“ `force = 50N` â†’ `reward_grasp = -90`
- å½“ `force = 100N` â†’ `reward_grasp = -190`

**ä¿®å¤æ–¹æ¡ˆ**:
```python
reward_grasp = max(-10.0, 5.0 - 2.0 * (total_contact_force - force_threshold_high))
```

---

### é—®é¢˜3: æˆåŠŸæ¡ä»¶é€»è¾‘é”™è¯¯

**ä½ç½®**: `DcmmVecEnvStage2.py` Line 588-623

**åŸé—®é¢˜**:
- **Catching ä»»åŠ¡**: æ²¡æœ‰è®¾ç½® `is_success`ï¼Œåªæ£€æŸ¥è¶…æ—¶
- **Tracking ä»»åŠ¡**: é”™è¯¯åœ°ä½¿ç”¨äº†æ‰‹éƒ¨åŠ›è§‰æˆåŠŸæ¡ä»¶ï¼ˆä½† Tracking ä¸æ§åˆ¶æ‰‹ï¼‰

**ä¿®å¤æ–¹æ¡ˆ**:

**Catching ä»»åŠ¡æ–°æˆåŠŸæ¡ä»¶**:
```python
# 1. å„æ‰‹æŒ‡ç¨³å®šè½¯åŠ›æ¥è§¦ (0.2N <= force <= 1.0N)
# 2. è‡³å°‘ 3 ä¸ªæ‰‹æŒ‡ç¨³å®šæ¥è§¦
# 3. æŒç»­ 2.0 ç§’
# 4. æ‰°åŠ¨æµ‹è¯•é€šè¿‡ (æ»‘ç§» < 1cm)
```

**Tracking ä»»åŠ¡æ–°æˆåŠŸæ¡ä»¶**:
```python
# 1. ee_distance < 0.05m
# 2. æŒç»­ 1.0 ç§’
```

---

## âœ… ä¿®æ”¹æ€»ç»“

| æ–‡ä»¶ | ä¿®æ”¹é¡¹ | åŸå€¼ | æ–°å€¼ |
|------|--------|------|------|
| `RewardManagerStage2.py` | `reward_impact` ä¸‹é™ | æ— é™åˆ¶ | **-30.0** |
| `RewardManagerStage2.py` | `reward_grasp` ä¸‹é™ | æ— é™åˆ¶ | **-10.0** |
| `DcmmVecEnvStage2.py` | Catching æˆåŠŸæ¡ä»¶ | æ—  | å¤šæ‰‹æŒ‡ç¨³å®š2ç§’+æ‰°åŠ¨æµ‹è¯• |
| `DcmmVecEnvStage2.py` | Tracking æˆåŠŸæ¡ä»¶ | åŠ›è§‰æ¥è§¦ | è·ç¦»æ¥è¿‘1ç§’ |

---

## ğŸ“ å…³é”®å‚æ•°é…ç½®

### å¥–åŠ±å‡½æ•°å‚æ•°

| å‚æ•° | å€¼ | è¯´æ˜ |
|------|-----|------|
| `reward_reaching` ç³»æ•° | 2.0 | tanh å†…ç³»æ•° |
| `reward_orientation` æœ€å¤§å€¼ | 2.0 | å¯¹é½å¥–åŠ± |
| `force_threshold_low` | 1.0N | æŠ“å–åŠ›ä¸‹é™ |
| `force_threshold_high` | 2.5N | æŠ“å–åŠ›ä¸Šé™ |
| `reward_impact` ä¸‹é™ | **-30.0** | æ–°å¢ |
| `reward_grasp` ä¸‹é™ | **-10.0** | æ–°å¢ |
| `reward_success` | 50.0 | æˆåŠŸå¥–åŠ± |

### æˆåŠŸæ¡ä»¶å‚æ•° (Catching)

| å‚æ•° | å€¼ |
|------|-----|
| æ¯æ‰‹æŒ‡åŠ›èŒƒå›´ | 0.2N ~ 1.0N |
| æœ€å°‘æ‰‹æŒ‡æ•° | 3 |
| ç¨³å®šæŒç»­æ—¶é—´ | 2.0 ç§’ |
| æ‰°åŠ¨æ»‘ç§»é˜ˆå€¼ | 1 cm |

### è¯¾ç¨‹å­¦ä¹ å‚æ•°

| å‚æ•° | èµ·å§‹å€¼ | ç»“æŸå€¼ |
|------|--------|--------|
| `collision_stem` | -1.0 | -20.0 |
| `orient_power` | 1.0 | 4.0 |

---

## ğŸš€ å»ºè®®åç»­è¡ŒåŠ¨

1. **é‡æ–°è®­ç»ƒ** (æ¨è): ä½¿ç”¨ä¿®å¤åçš„å¥–åŠ±å‡½æ•°ä»å¤´å¼€å§‹
   ```bash
   python train_stage2.py num_envs=16 seed=43 output_name=Dcmm_Catch_fixed
   ```

2. **ç›‘æ§æ–°æŒ‡æ ‡**: 
   - `rewards/impact_mean` åº”ç¨³å®šåœ¨ -30 ~ 0 èŒƒå›´å†…
   - `rewards/grasp_mean` åº”ç¨³å®šåœ¨ -10 ~ 9 èŒƒå›´å†…
   - Episode Reward ä¸åº”å‡ºç°æç«¯è´Ÿå€¼

3. **è§‚å¯ŸæˆåŠŸç‡**: ä¿®å¤åæˆåŠŸç‡ç»Ÿè®¡å°†åæ˜ çœŸå®æŠ“å–æˆåŠŸ

---

## ğŸ“ ç›¸å…³æ–‡ä»¶

- ä¿®æ”¹æ–‡ä»¶: 
  - `gym_dcmm/envs/stage2/RewardManagerStage2.py`
  - `gym_dcmm/envs/stage2/DcmmVecEnvStage2.py`
- è§„æ ¼æ–‡æ¡£:
  - `Stage1_Specification.md`
  - `Stage2_Specification.md`

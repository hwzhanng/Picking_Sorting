# Catch It: åŸºäºå¼ºåŒ–å­¦ä¹ çš„ä¸¤é˜¶æ®µå†œä¸šé‡‡æ‘˜é¡¹ç›®

## é¡¹ç›®æ¦‚è¿°
"Catch It" æ˜¯ä¸€ä¸ªå¼ºåŒ–å­¦ä¹  (RL) é¡¹ç›®,æ—¨åœ¨è®­ç»ƒä¸€ä¸ªç§»åŠ¨æ“ä½œæœºå™¨äºº(é…å¤‡ç§»åŠ¨åº•ç›˜ã€6è‡ªç”±åº¦æœºæ¢°è‡‚å’Œçµå·§æ‰‹)åœ¨å†œä¸šåœºæ™¯ä¸­è‡ªä¸»å¯¼èˆªè‡³ç›®æ ‡æœå®å¹¶è¿›è¡Œé‡‡æ‘˜ã€‚æœ¬é¡¹ç›®é‡‡ç”¨ **ä¸¤é˜¶æ®µè®­ç»ƒ (Two-Stage Training)** æ–¹æ³•å’Œ**åŠ¨æ€è¯¾ç¨‹å­¦ä¹  (Curriculum Learning)**,é«˜æ•ˆè§£å†³ç§»åŠ¨é‡‡æ‘˜è¿™ä¸€å¤æ‚çš„é•¿è§†è·ä»»åŠ¡ã€‚

### æ ¸å¿ƒç‰¹æ€§
- **ğŸŒ¾ å†œä¸šåœºæ™¯é€‚é…**: é™æ€æœå®ç›®æ ‡ã€æ¤æ ªéšœç¢ç‰©(æ ‘å¹²/æ ‘å¶)ã€è§†é‡çº¦æŸ
- **ğŸ“š åŠ¨æ€è¯¾ç¨‹å­¦ä¹ **: ä»"æ¢ç´¢"åˆ°"çº¦æŸ"çš„æ¸è¿›å¼è®­ç»ƒ(0-6Mæ­¥ä¸‰é˜¶æ®µ)
- **ğŸ¯ ç²¾ç»†åŒ–å¥–åŠ±å‡½æ•°**: 8ç§å¥–åŠ±åˆ†é‡,åŒºåˆ†åˆšæ€§/æŸ”æ€§ç¢°æ’,é€Ÿåº¦æ„ŸçŸ¥æƒ©ç½š
- **ğŸ”§ å…³èŠ‚ç©ºé—´æ§åˆ¶**: ç›´æ¥è¾“å‡ºå…³èŠ‚è§’åº¦å¢é‡,é¿å…IKä¸ç¨³å®šæ€§
- **ğŸ¨ ä¸¤é˜¶æ®µ RL æ¡†æ¶**: å°†ä»»åŠ¡åˆ†è§£ä¸º **è¿½è¸ª (Tracking)** å’Œ **æŠ“å– (Catching)** ä¸¤ä¸ªé˜¶æ®µ
- **ğŸ¤– Sim2Real å°±ç»ª**: å†…ç½®åŸŸéšæœºåŒ–(è§‚æµ‹å™ªå£°ã€åŠ¨ä½œå»¶è¿Ÿã€æ·±åº¦ç¼ºå¤±),ä¾¿äºä» MuJoCo ä»¿çœŸè¿ç§»åˆ°çœŸæœºç¡¬ä»¶
- **ğŸ§© æ¨¡å—åŒ–è®¾è®¡**: ç¯å¢ƒ (`gym_dcmm`)ã€ç®—æ³• (`PPO`) å’Œé…ç½® (`hydra`) åˆ†ç¦»,ç»“æ„æ¸…æ™°
- **ğŸ“ å®Œå…¨ç‹¬ç«‹çš„è®­ç»ƒæµç¨‹**: Stage 1 å’Œ Stage 2 æ‹¥æœ‰ç‹¬ç«‹çš„æ–‡ä»¶ç»“æ„,ä¾¿äºè°ƒè¯•å’Œä¿®æ”¹

---

## ğŸ†• æœ€æ–°æ›´æ–°äº®ç‚¹

### 1. æ–‡ä»¶ç³»ç»Ÿé‡æ„ (2025-12)
**å®Œå…¨åˆ†ç¦» Stage 1 å’Œ Stage 2**,å®ç°ç‹¬ç«‹å¼€å‘:
- âœ… ç‹¬ç«‹çš„ç¯å¢ƒ: `gym_dcmm/envs/stage1/` å’Œ `gym_dcmm/envs/stage2/`
- âœ… ç‹¬ç«‹çš„ç®—æ³•: `gym_dcmm/algs/ppo_dcmm/stage1/` å’Œ `gym_dcmm/algs/ppo_dcmm/stage2/`
- âœ… ç‹¬ç«‹çš„è®­ç»ƒè„šæœ¬: `train_stage1.py` å’Œ `train_stage2.py`
- âœ… ç‹¬ç«‹çš„é…ç½®: `configs/config_stage1.yaml` å’Œ `configs/config_stage2.yaml`
- âœ… æ ‡å‡†åŒ–å‘½å: æ‰€æœ‰ç±»åéµå¾ª `*Stage1` / `*Stage2` è§„èŒƒ

### 2. åŠ¨æ€è¯¾ç¨‹å­¦ä¹ æœºåˆ¶
è®­ç»ƒè¿‡ç¨‹è‡ªåŠ¨åˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µ,é€æ­¥æé«˜ä»»åŠ¡éš¾åº¦:

| é˜¶æ®µ | è®­ç»ƒæ­¥æ•° | æ ‘å¹²ç¢°æ’æƒ©ç½š | æœå‘ç²¾åº¦è¦æ±‚ | è®­ç»ƒç›®æ ‡ |
|------|---------|------------|------------|---------| 
| ğŸ« å¹¼å„¿å›­ | 0 - 2M | -1.0 (è½»å¾®) | 1æ¬¡æ–¹ (å®½æ¾) | å»ºç«‹ä¿¡å¿ƒ,å­¦ä¼šæ¢ç´¢ |
| ğŸ“ å°å­¦ | 2M - 6M | -1.0 â†’ -20.0 | 1 â†’ 4æ¬¡æ–¹ | å­¦ä¼šè§„é¿,ç²¾ç¡®å®šä½ |
| ğŸ’¼ èŒä¸š | > 6M | -20.0 (ä¸¥å‰) | 4æ¬¡æ–¹ (ä¸¥æ ¼) | ç²¾å‡†ä½œä¸š,é›¶å®¹å¿ |

**ä¼˜åŠ¿**: é¿å…"è¿‡æ—©å¤±è´¥",æ™ºèƒ½ä½“èƒ½åœ¨å®½æ¾ç¯å¢ƒä¸­å¿«é€Ÿå»ºç«‹åŸºæœ¬èƒ½åŠ›,å†é€æ­¥é€‚åº”ä¸¥æ ¼çº¦æŸã€‚

### 3. ç²¾ç»†åŒ–å¥–åŠ±å‡½æ•°
é‡æ„åçš„å¥–åŠ±ç³»ç»ŸåŒ…å«8ä¸ªåˆ†é‡:

1. **åˆ°è¾¾å¥–åŠ±**: `1.0 * (1.0 - tanh(2.0 * distance))` - å½’ä¸€åŒ–é˜²çˆ†ç‚¸
2. **åº•ç›˜å®šä½å¥–åŠ±**: `exp(-5.0 * (distance - 0.8)^2)` - å¼•å¯¼è‡³æœ€ä½³æ“ä½œè·ç¦»
3. **æœå‘å¥–åŠ±**: `max(0, alignment)^orient_power * 2.0` - åŠ¨æ€ä¸¥æ ¼åº¦(1â†’4æ¬¡æ–¹)
4. **æ¥è§¦å¥–åŠ±**: `10.0 - 4.0 * impact_speed` - é¼“åŠ±æ¸©æŸ”æ¥è§¦
5. **æ­£åˆ™åŒ–**: `-0.01 * ||ctrl||` - å¹³æ»‘æ§åˆ¶
6. **ç¢°æ’æƒ©ç½š**: `-10.0` - åº•ç›˜ç¢°æ’åœ°é¢(ç»ˆæ­¢)
7. **æ¤ç‰©ç¢°æ’**: 
   - æ ‘å¹²(åˆšæ€§): åŠ¨æ€æƒ©ç½š `-1.0 â†’ -20.0`
   - æ ‘å¶(æŸ”æ€§): è½»å¾®æƒ©ç½š `-0.5 * (1.0 + vel)`
8. **åŠ¨ä½œå¹³æ»‘**: `-0.05 * ||action_diff||` - æƒ©ç½šçªå˜

### 4. å†œä¸šåœºæ™¯ç‰¹æ€§
- **é™æ€æœå®**: ä½¿ç”¨ mocap å›ºå®šç›®æ ‡ä½ç½®,å»é™¤é€Ÿåº¦è§‚æµ‹
- **æ¤æ ªéšœç¢**: éšæœºç”Ÿæˆæ ‘å¹²å’Œæ ‘å¶,æ¨¡æ‹ŸçœŸå®å†œç”°
- **è§†é‡çº¦æŸ**: æœå®å’Œæ¤æ ªä»…åœ¨æœºå™¨äººå‰æ–¹è§†é‡å†…ç”Ÿæˆ
- **é¡¶éƒ¨æ‘„åƒå¤´**: ä½¿ç”¨è½¦é¡¶æ·±åº¦ç›¸æœºè§‚æµ‹åœºæ™¯

### 5. Stage 2 ä¼˜åŒ– (2025-12)
**ä¸‰å¤§å…³é”®ä¼˜åŒ–æå‡è®­ç»ƒæ•ˆç‡å’ŒæŠ“å–è´¨é‡**:
- âœ… **å†…å­˜ä¼˜åŒ–**: `uint8` æ·±åº¦å­˜å‚¨,èŠ‚çœ75%æ˜¾å­˜ (220MBâ†’55MB)
- âœ… **æ‰°åŠ¨æµ‹è¯•**: å¤–åŠ›éªŒè¯æŠ“å–ç¨³å®šæ€§ (2-5NéšæœºåŠ›,1cmæ»‘ç§»é˜ˆå€¼)
- âœ… **é€Ÿåº¦æƒ©ç½š**: å¼ºåŒ–æƒ©ç½šç³»æ•°è‡³ `-6.0`,é˜²æ­¢å†²å‡»å¼æ¥è§¦ (0.5m/sæ—¶æƒ©ç½š-10.3)

---

## æ¶æ„ä¸å·¥ä½œæµ

### ç¬¬ä¸€é˜¶æ®µ:è¿½è¸ª (Tracking / Stage 1)
- **ç›®æ ‡**: æ§åˆ¶ç§»åŠ¨åº•ç›˜å’Œæœºæ¢°è‡‚æ¥è¿‘ç›®æ ‡æœå®,æ‰‹æŒæœå‘ç›®æ ‡,é¿å¼€æ¤æ ªéšœç¢
- **è¾“å…¥**: æœºå™¨äººçŠ¶æ€(åº•ç›˜, æ‰‹è‡‚) + æœå®ä½ç½® + æ·±åº¦å›¾åƒ
- **è¾“å‡º**: åº•ç›˜é€Ÿåº¦ + æ‰‹è‡‚å…³èŠ‚è§’åº¦å¢é‡
- **è¯¾ç¨‹å­¦ä¹ **: è®­ç»ƒè¿‡ç¨‹ä¸­è‡ªåŠ¨ä»"å®½æ¾æ¢ç´¢"è¿‡æ¸¡åˆ°"ç²¾å‡†çº¦æŸ"
- **æˆæœ**: è®­ç»ƒå‡ºä¸€ä¸ª"é‡‡æ‘˜å¯¼èˆªå‘˜"ç­–ç•¥,èƒ½å®‰å…¨é«˜æ•ˆåœ°å°†æœºå™¨äººå¼•å¯¼è‡³æœå®é™„è¿‘

### ç¬¬äºŒé˜¶æ®µ:æŠ“å– (Catching / Stage 2)
- **ç›®æ ‡**: åœ¨åº•ç›˜å’Œæ‰‹è‡‚ç”±ç¬¬ä¸€é˜¶æ®µç­–ç•¥æ§åˆ¶çš„æƒ…å†µä¸‹,è®­ç»ƒçµå·§æ‰‹æŠ“å–å¹¶é‡‡æ‘˜æœå®
- **æœºåˆ¶**: 
    - åŠ è½½é¢„è®­ç»ƒçš„è¿½è¸ªæ¨¡å‹å¹¶ **å†»ç»“** å…¶å‚æ•°
    - è®­ç»ƒä¸€ä¸ªæ–°çš„ç­–ç•¥ä¸“é—¨æ§åˆ¶çµå·§æ‰‹è¿›è¡ŒæŠ“å–åŠ¨ä½œ
- **ğŸ†• æ ¸å¿ƒä¼˜åŒ–**:
    - **å†…å­˜æ•ˆç‡**: æ·±åº¦å›¾ä»¥ `uint8` æ ¼å¼å­˜å‚¨,èŠ‚çœ 75% GPU æ˜¾å­˜
    - **æ‰°åŠ¨éªŒè¯**: æ–½åŠ  2-5N éšæœºå¤–åŠ›æµ‹è¯•æŠ“å–ç¨³å®šæ€§,æŠ—æ»‘ç§»èƒ½åŠ› < 1cm å¥–åŠ± +10.0
    - **æ¸©æŸ”æ¥è§¦**: é€Ÿåº¦æƒ©ç½šç³»æ•° `-6.0`,ç¡®ä¿ 0.5m/s æ—¶æƒ©ç½š (-10.3) è¶…è¿‡æ¥è§¦å¥–åŠ± (9.0)
- **æˆæœ**: ä¸€ä¸ªèƒ½å¤Ÿæ¥è¿‘ã€æœå‘å¹¶ **ç¨³å›º** é‡‡æ‘˜æœå®çš„å®Œæ•´ç³»ç»Ÿ

---

## å®‰è£…æŒ‡å—

1.  **å…‹éš†ä»“åº“**:
    ```bash
    git clone <repository_url>
    cd catch_it
    ```

2.  **åˆ›å»º Conda ç¯å¢ƒ**:
    ```bash
    conda create -n dcmm python=3.8
    conda activate dcmm
    ```

3.  **å®‰è£…ä¾èµ–**:
    ```bash
    pip install -r requirements.txt
    ```

---

## ä½¿ç”¨è¯´æ˜

### 1. è®­ç»ƒç¬¬ä¸€é˜¶æ®µ:è¿½è¸ª (Tracking / Stage 1)
è®­ç»ƒåº•ç›˜å’Œæ‰‹è‡‚æ¥è¿‘æœå®,åŒæ—¶é¿å¼€æ¤æ ªã€‚

```bash
python train_stage1.py
```

**è®­ç»ƒè¿‡ç¨‹**:
- 0-2Mæ­¥:æ™ºèƒ½ä½“å¤§èƒ†æ¢ç´¢,å¯èƒ½é¢‘ç¹ç¢°æ’æ ‘å¹²(æƒ©ç½š-1.0)
- 2M-6Mæ­¥:é€æ¸å­¦ä¼šç»•è¡Œ,æœå‘è¦æ±‚æé«˜
- >6Mæ­¥:ç²¾å‡†é¿éšœ,æ‰‹æŒå®Œç¾å¯¹å‡†æœå®

*æ¨¡å‹æ£€æŸ¥ç‚¹å°†ä¿å­˜åœ¨ `outputs/Dcmm/YYYY-MM-DD/HH:MM:SS/nn/` ç›®å½•ä¸‹ã€‚*

### 2. è®­ç»ƒç¬¬äºŒé˜¶æ®µ:æŠ“å– (Catching / Stage 2)
ä½¿ç”¨é¢„è®­ç»ƒçš„è¿½è¸ªæ¨¡å‹,è®­ç»ƒçµå·§æ‰‹è¿›è¡ŒæŠ“å–ã€‚

**æ³¨æ„**: è¯·ç¡®ä¿ `configs/config_stage2.yaml` ä¸­çš„ `checkpoint_tracking` æŒ‡å‘ä½ æœ€å¥½çš„ç¬¬ä¸€é˜¶æ®µæ¨¡å‹è·¯å¾„ã€‚

```bash
python train_stage2.py checkpoint_tracking="outputs/Dcmm/.../best_reward_XXX.pth"
```

### 3. æµ‹è¯• / å¯è§†åŒ–
å¯è§†åŒ–è®­ç»ƒå¥½çš„æ™ºèƒ½ä½“(æ¸²æŸ“æ¨¡å¼):

```bash
# æµ‹è¯•è¿½è¸ªé˜¶æ®µ (Stage 1)
python train_stage1.py test=True checkpoint_tracking="path/to/best.pth" num_envs=1 viewer=True

# æµ‹è¯•å®Œæ•´é‡‡æ‘˜æµç¨‹ (Stage 2)
python train_stage2.py test=True checkpoint_tracking="path/to/track.pth" checkpoint_catching="path/to/catch.pth" num_envs=1 viewer=True
```

---

## é…ç½®è¯´æ˜

### Stage 1 é…ç½® (`configs/config_stage1.yaml`)
- è®¾ç½®ä»»åŠ¡ç±»å‹: `task: Tracking`
- ç¯å¢ƒæ•°é‡ (`num_envs`): å¹¶è¡Œç¯å¢ƒæ•°(å»ºè®®16-32)
- æ¨¡å‹åŠ è½½è·¯å¾„ (`checkpoint_tracking`)
- WandB å®éªŒè·Ÿè¸ªé…ç½®
- é»˜è®¤è®­ç»ƒé…ç½®: `train/stage1/PPO_Stage1.yaml`

### Stage 2 é…ç½® (`configs/config_stage2.yaml`)
- è®¾ç½®ä»»åŠ¡ç±»å‹: `task: Catching_TwoStage`  
- ç¯å¢ƒæ•°é‡ (`num_envs`): å¹¶è¡Œç¯å¢ƒæ•°(å»ºè®®16-32)
- æ¨¡å‹åŠ è½½è·¯å¾„ (`checkpoint_tracking`, `checkpoint_catching`)
- WandB å®éªŒè·Ÿè¸ªé…ç½®
- é»˜è®¤è®­ç»ƒé…ç½®: `train/stage2/PPO_Stage2.yaml`

### ç¯å¢ƒé…ç½® (`configs/env/DcmmCfg.py`)

#### ğŸ†• è¯¾ç¨‹å­¦ä¹ é…ç½® (`curriculum` ç±»)
```python
class curriculum:
    stage1_steps = 2e6  # ç¬¬ä¸€é˜¶æ®µæ­¥æ•°é˜ˆå€¼
    stage2_steps = 6e6  # ç¬¬äºŒé˜¶æ®µæ­¥æ•°é˜ˆå€¼
    
    # æ ‘å¹²ç¢°æ’æƒ©ç½šèŒƒå›´
    collision_stem_start = -1.0
    collision_stem_end = -20.0
    
    # æœå‘ç²¾åº¦è¦æ±‚èŒƒå›´(æ¬¡æ–¹æ•°)
    orient_power_start = 1.0
    orient_power_end = 4.0
```

**è°ƒæ•´å»ºè®®**:
- å¦‚æœæ™ºèƒ½ä½“å­¦ä¹ å¤ªæ…¢,å¯ä»¥å»¶é•¿ `stage1_steps` (å¢åŠ æ¢ç´¢æ—¶é—´)
- å¦‚æœæƒ³è¦æ›´ä¸¥æ ¼çš„æœ€ç»ˆè¡Œä¸º,å¯ä»¥å¢å¤§ `collision_stem_end` æˆ– `orient_power_end`

#### Sim2Real é…ç½®
```python
# è§‚æµ‹å™ªå£°(æ¨¡æ‹Ÿä¼ æ„Ÿå™¨ä¸ç¡®å®šæ€§)
k_obs_object = 0.025  # ç›®æ ‡ç‰©ä½“ä½ç½®å™ªå£°

# åŠ¨ä½œå»¶è¿Ÿ(æ¨¡æ‹ŸçœŸå®æ‰§è¡Œå»¶è¿Ÿ)
act_delay = {
    'base': [1, 2, 3],  # åº•ç›˜:20-60ms
    'arm': [1, 2, 3],   # æœºæ¢°è‡‚:20-60ms
    'hand': [1, 2, 3],  # çµå·§æ‰‹:20-60ms
}
```

---

## é¡¹ç›®ç»“æ„

```
catch_it/
â”œâ”€â”€ train_stage1.py            # Stage 1 è®­ç»ƒè„šæœ¬ (Tracking)
â”œâ”€â”€ train_stage2.py            # Stage 2 è®­ç»ƒè„šæœ¬ (Catching)
â”œâ”€â”€ test_env.py                # ç¯å¢ƒæµ‹è¯•è„šæœ¬
â”œâ”€â”€ configs/                   # é…ç½®æ–‡ä»¶ (Hydra & Python)
â”‚   â”œâ”€â”€ config_stage1.yaml     # Stage 1 ä¸»é…ç½®
â”‚   â”œâ”€â”€ config_stage2.yaml     # Stage 2 ä¸»é…ç½®
â”‚   â”œâ”€â”€ env/DcmmCfg.py         # ç¯å¢ƒé…ç½®(å«è¯¾ç¨‹å­¦ä¹ å‚æ•°)
â”‚   â””â”€â”€ train/
â”‚       â”œâ”€â”€ stage1/
â”‚       â”‚   â””â”€â”€ PPO_Stage1.yaml    # Stage 1 PPO å‚æ•°
â”‚       â””â”€â”€ stage2/
â”‚           â””â”€â”€ PPO_Stage2.yaml    # Stage 2 PPO å‚æ•°
â”œâ”€â”€ gym_dcmm/                  # ç¯å¢ƒåŒ…
â”‚   â”œâ”€â”€ envs/
â”‚   â”‚   â”œâ”€â”€ stage1/            # Stage 1 ç¯å¢ƒç›®å½•
â”‚   â”‚   â”‚   â”œâ”€â”€ DcmmVecEnvStage1.py      # Stage 1 ä¸»ç¯å¢ƒ
â”‚   â”‚   â”‚   â””â”€â”€ RewardManagerStage1.py   # Stage 1 å¥–åŠ±ç®¡ç†å™¨
â”‚   â”‚   â”œâ”€â”€ stage2/            # Stage 2 ç¯å¢ƒç›®å½•
â”‚   â”‚   â”‚   â”œâ”€â”€ DcmmVecEnvStage2.py      # Stage 2 ä¸»ç¯å¢ƒ
â”‚   â”‚   â”‚   â””â”€â”€ RewardManagerStage2.py   # Stage 2 å¥–åŠ±ç®¡ç†å™¨
â”‚   â”‚   â”œâ”€â”€ observation_manager.py   # è§‚æµ‹å¤„ç† (å…±äº«)
â”‚   â”‚   â”œâ”€â”€ control_manager.py       # æ§åˆ¶ç®¡ç† (å…±äº«)
â”‚   â”‚   â”œâ”€â”€ randomization_manager.py # åœºæ™¯éšæœºåŒ– (å…±äº«)
â”‚   â”‚   â”œâ”€â”€ render_manager.py        # æ¸²æŸ“ç®¡ç† (å…±äº«) 
â”‚   â”‚   â””â”€â”€ constants.py             # å¸¸é‡å®šä¹‰ (å…±äº«)
â”‚   â”œâ”€â”€ agents/MujocoDcmm.py   # MuJoCo æ¥å£ + PID æ§åˆ¶
â”‚   â”œâ”€â”€ algs/ppo_dcmm/         # PPO ç®—æ³•å®ç°
â”‚   â”‚   â”œâ”€â”€ stage1/            # Stage 1 ç®—æ³•ç›®å½•
â”‚   â”‚   â”‚   â”œâ”€â”€ PPO_Stage1.py        # Stage 1 PPO è®­ç»ƒ
â”‚   â”‚   â”‚   â””â”€â”€ ModelsStage1.py      # Stage 1 ç½‘ç»œ(CNN+MLP)
â”‚   â”‚   â”œâ”€â”€ stage2/            # Stage 2 ç®—æ³•ç›®å½•
â”‚   â”‚   â”‚   â”œâ”€â”€ PPO_Stage2.py        # Stage 2 PPO è®­ç»ƒ
â”‚   â”‚   â”‚   â””â”€â”€ ModelsStage2.py      # Stage 2 ç½‘ç»œ
â”‚   â”‚   â”œâ”€â”€ experience.py      # ç»éªŒç¼“å†² (å…±äº«)
â”‚   â”‚   â””â”€â”€ utils.py           # å·¥å…·å‡½æ•° (å…±äº«)
â”‚   â””â”€â”€ utils/                 # å·¥å…·å‡½æ•°
â”‚       â”œâ”€â”€ util.py            # é€šç”¨å·¥å…·
â”‚       â”œâ”€â”€ pid.py             # PID æ§åˆ¶å™¨
â”‚       â””â”€â”€ quat_utils.py      # å››å…ƒæ•°å·¥å…·
â”œâ”€â”€ assets/                    # æœºå™¨äºº XML æ–‡ä»¶å’Œæ¨¡å‹æ£€æŸ¥ç‚¹
â”‚   â”œâ”€â”€ urdf/                  # MuJoCo XML æ¨¡å‹
â”‚   â”œâ”€â”€ meshes/                # 3D ç½‘æ ¼æ–‡ä»¶
â”‚   â””â”€â”€ models/                # é¢„è®­ç»ƒæƒé‡(.pth)
â””â”€â”€ outputs/                   # è®­ç»ƒè¾“å‡º(æ£€æŸ¥ç‚¹ã€æ—¥å¿—)
```

---

## ğŸ“ è¯¾ç¨‹å­¦ä¹ çš„å·¥ä½œåŸç†

### æ ¸å¿ƒæ€æƒ³
ä¼ ç»ŸRLè®­ç»ƒå¯¹æ™ºèƒ½ä½“è¦æ±‚"ä»ä¸€å¼€å§‹å°±åšå¯¹",å¯¼è‡´å¤§é‡æ—©æœŸå¤±è´¥å’Œä½æ•ˆæ¢ç´¢ã€‚è¯¾ç¨‹å­¦ä¹ æ¨¡ä»¿äººç±»å­¦ä¹ è¿‡ç¨‹,**å…ˆå»ºç«‹ä¿¡å¿ƒ,å†è¿½æ±‚å®Œç¾**ã€‚

### å®ç°æœºåˆ¶
1. **è®­ç»ƒè„šæœ¬** (`PPO_Stage1.py`):
   - æ¯æ¬¡æ”¶é›†ç»éªŒå‰,è°ƒç”¨ `env.set_global_step(current_step)`
   
2. **ç¯å¢ƒè°ƒåº¦å™¨** (`DcmmVecEnvStage1.update_curriculum_difficulty()`)
   ```python
   difficulty = min(step / 6M, 1.0)  # 0.0 â†’ 1.0
   current_w_stem = -1.0 + (-20.0 - (-1.0)) * difficulty
   current_orient_power = 1.0 + (4.0 - 1.0) * difficulty
   ```

3. **å¥–åŠ±ç®¡ç†å™¨** (`RewardManagerStage1.compute_reward()`):
   - ä½¿ç”¨ `env.current_w_stem` ä½œä¸ºæ ‘å¹²ç¢°æ’æƒ©ç½š
   - ä½¿ç”¨ `env.current_orient_power` ä½œä¸ºæœå‘å¥–åŠ±æ¬¡æ–¹æ•°

### ç›‘æ§è¯¾ç¨‹è¿›åº¦
è®­ç»ƒæ—¶æ¯10kæ­¥ä¼šæ‰“å°è¯¾ç¨‹çŠ¶æ€:
```
[Curriculum] Step: 0, Stem Penalty: -1.00, Orient Power: 1.00
[Curriculum] Step: 1000000, Stem Penalty: -4.17, Orient Power: 1.50
[Curriculum] Step: 3000000, Stem Penalty: -10.50, Orient Power: 2.50
[Curriculum] Step: 6000000, Stem Penalty: -20.00, Orient Power: 4.00
```

---

## ğŸŒ¾ å†œä¸šåœºæ™¯è®¾è®¡

### é™æ€æœå®è®¾å®š
- ä½¿ç”¨ **mocap body** å›ºå®šæœå®ä½ç½®(ä¸å—ç‰©ç†å½±å“)
- ç§»é™¤ç‰©ä½“é€Ÿåº¦è§‚æµ‹(ä»15ç»´é™è‡³12ç»´)
- æ¨¡æ‹ŸçœŸå®å†œç”°ä¸­æœå®æŒ‚åœ¨æ ‘ä¸Šçš„çŠ¶æ€

### æ¤æ ªéšœç¢ç”Ÿæˆ
- **æ ‘å¹² (plant_stem)**: åˆšæ€§éšœç¢,ä¸¥ç¦ç¢°æ’
- **æ ‘å¶ (plant_leaf)**: æŸ”æ€§é®æŒ¡,å…è®¸è½»è§¦
- éšæœºä½ç½®:ä»…åœ¨æœºå™¨äººå‰æ–¹è§†é‡å†…ç”Ÿæˆ

### è§†è§‰è§‚æµ‹
- ä½¿ç”¨è½¦é¡¶æ·±åº¦ç›¸æœº(ä¿¯è§†è§’åº¦)
- æ·»åŠ é«˜æ–¯å™ªå£°å’Œåƒç´ ç¼ºå¤±(5-10%)æ¨¡æ‹ŸçœŸå®ä¼ æ„Ÿå™¨

---

## Sim2Real (ä»¿çœŸåˆ°çœŸæœº) éƒ¨ç½²æŒ‡å—

### 1. å¢å¤§åŸŸéšæœºåŒ–å¼ºåº¦
```python
# åœ¨ DcmmCfg.py ä¸­è°ƒæ•´
k_obs_object = 0.05   # å¢å¤§è§‚æµ‹å™ªå£°(é»˜è®¤0.025)
act_delay = {
    'base': [2, 3, 4],  # å¢å¤§å»¶è¿ŸèŒƒå›´(é»˜è®¤[1,2,3])
    'arm': [2, 3, 4],
    'hand': [2, 3, 4],
}
```

### 2. çœŸæœºç¡¬ä»¶åŒæ­¥
- **ä¼ æ„Ÿå™¨**: ç¡®ä¿æ·±åº¦ç›¸æœºä½ç½®å’ŒFOVä¸ä»¿çœŸä¸€è‡´
- **æ§åˆ¶é¢‘ç‡**: MuJoCo é»˜è®¤500Hz,çœŸæœºéœ€åŒ¹é… `steps_per_policy` (é»˜è®¤20æ­¥=40msä¸€æ¬¡ç­–ç•¥)
- **å…³èŠ‚é™ä½**: éªŒè¯çœŸæœºå…³èŠ‚é™ä½ä¸ XML å®šä¹‰ä¸€è‡´

### 3. éƒ¨ç½²æµç¨‹
```bash
# 1. å¯¼å‡ºç­–ç•¥æƒé‡
weights = torch.load("best_reward_XXX.pth")
actor_weights = weights['model']['actor_mlp']

# 2. åœ¨çœŸæœºROSèŠ‚ç‚¹ä¸­åŠ è½½
model = ActorCritic(net_config)
model.load_state_dict(actor_weights)
model.eval()

# 3. å®æ—¶æ¨ç†
obs = get_robot_state()  # ä»ä¼ æ„Ÿå™¨è·å–
action = model.act_inference(obs)
send_to_robot(action)    # å‘é€åˆ°åº•å±‚æ§åˆ¶å™¨
```

---

## å¸¸è§é—®é¢˜ (FAQ)

### Q1: è®­ç»ƒæ—¶å¥–åŠ±ä¸€ç›´æ˜¯è´Ÿæ•°?
**A**: è¿™æ˜¯æ­£å¸¸çš„,å°¤å…¶æ˜¯åœ¨"å¹¼å„¿å›­é˜¶æ®µ"ã€‚è§‚å¯Ÿ `[Curriculum]` æ‰“å°,ç¡®è®¤è¯¾ç¨‹å‚æ•°åœ¨å˜åŒ–å³å¯ã€‚å…³æ³¨å¥–åŠ±è¶‹åŠ¿(æ˜¯å¦ä¸Šå‡),è€Œéç»å¯¹å€¼ã€‚

### Q2: å¦‚ä½•åŠ å¿«è®­ç»ƒé€Ÿåº¦?
**A**: 
1. å¢åŠ  `num_envs` (å¹¶è¡Œç¯å¢ƒæ•°)åˆ°ä½ çš„CPU/GPUèƒ½æ‰¿å—çš„ä¸Šé™
2. å‡å° `horizon_length` (å¦‚64â†’32)ä»¥å¢åŠ æ›´æ–°é¢‘ç‡
3. ç¡®ä¿ä½¿ç”¨GPU: `rl_device='cuda:0'`

### Q3: æ™ºèƒ½ä½“å­¦ä¼šäº†ç¢°æ’æ ‘å¹²å"å¡ä½"?
**A**: å¯èƒ½æ˜¯æƒ©ç½šå¤ªå¼ºã€‚å°è¯•:
1. å»¶é•¿ `stage1_steps` (ç»™æ›´å¤šæ¢ç´¢æ—¶é—´)
2. å‡å° `collision_stem_end` (å¦‚-20.0â†’-10.0)
3. å¢å¤§ `reward_reaching` æƒé‡(é¼“åŠ±ç»§ç»­å‰è¿›)

### Q4: ç¬¬äºŒé˜¶æ®µè®­ç»ƒæ—¶åº•ç›˜ä¸åŠ¨?
**A**: ç¡®è®¤ `checkpoint_tracking` è·¯å¾„æ­£ç¡®,ä¸”æˆåŠŸå†»ç»“è¿½è¸ªæ¨¡å‹ã€‚æ£€æŸ¥æ—¥å¿—ä¸­æ˜¯å¦æœ‰"åŠ è½½é¢„è®­ç»ƒæ¨¡å‹"çš„æç¤ºã€‚

### Q5: Stage 1 å’Œ Stage 2 çš„åŒºåˆ«?
**A**: 
- **Stage 1**: è®­ç»ƒåº•ç›˜+æœºæ¢°è‡‚,æ‰‹æŒå›ºå®šå¼ å¼€å§¿æ€
- **Stage 2**: åº•ç›˜+æœºæ¢°è‡‚ç”±é¢„è®­ç»ƒæ¨¡å‹æ§åˆ¶(å†»ç»“),ä»…è®­ç»ƒçµå·§æ‰‹
- ä¸¤ä¸ªé˜¶æ®µç°åœ¨æ‹¥æœ‰**å®Œå…¨ç‹¬ç«‹çš„æ–‡ä»¶ç»“æ„**,å¯ä»¥åˆ†åˆ«ä¿®æ”¹è€Œä¸å½±å“å½¼æ­¤

---

**ä¾èµ–é¡¹ç›®**:
- MuJoCo: é«˜æ€§èƒ½ç‰©ç†å¼•æ“
- Gymnasium: å¼ºåŒ–å­¦ä¹ ç¯å¢ƒæ¥å£
- Stable-Baselines3: PPO ç®—æ³•å‚è€ƒå®ç°
- WandB: å®éªŒè·Ÿè¸ªå’Œå¯è§†åŒ–

---

## è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ã€‚è¯¦è§ LICENSE æ–‡ä»¶ã€‚

---

## è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®,è¯·é€šè¿‡ä»¥ä¸‹æ–¹å¼è”ç³»:
- GitHub Issues: [é¡¹ç›®Issuesé¡µé¢]
- Email: your.email@example.com

ç¥è®­ç»ƒé¡ºåˆ©! ğŸš€ğŸŒ¾
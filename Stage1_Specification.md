# Stage 1 (Tracking) å®Œæ•´è§„æ ¼æ–‡æ¡£

## æ¦‚è¿°

Stage 1 æ˜¯å¯¼èˆªè¿½è¸ªé˜¶æ®µï¼Œæ§åˆ¶ç§»åŠ¨åº•ç›˜å’Œ6è‡ªç”±åº¦æœºæ¢°è‡‚ï¼Œä½¿æœ«ç«¯æ‰§è¡Œå™¨æ¥è¿‘ç›®æ ‡ç‰©ä½“ã€‚é‡‡ç”¨**å¯¹ç§°Actor-Critic**æ¶æ„ï¼Œå¯é€‰AVPï¼ˆä¸å¯¹ç§°ä»·å€¼ä¼ æ’­ï¼‰è¾…åŠ©è®­ç»ƒã€‚

---

## ğŸ§  PPO ç½‘ç»œæ¶æ„

### æ¶æ„ç‰¹ç‚¹

ä¸ Stage 2 ä¸åŒï¼ŒStage 1 é‡‡ç”¨**å¯¹ç§°æ¶æ„**ï¼šActor å’Œ Critic ä½¿ç”¨ç›¸åŒè¾“å…¥ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Observation                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Vector (15ç»´)    â”‚  â”‚   Depth Image (224Ã—224) å¯é€‰   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚           â”‚                           â”‚                     â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚                       â–¼                                     â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚
â”‚              â”‚  Actor & Critic â”‚                            â”‚
â”‚              â”‚   å¯¹ç§°è¾“å…¥æ¶æ„   â”‚                            â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç½‘ç»œè¾“å…¥ (å…±äº«)

| ç»„ä»¶ | ç»´åº¦ | è¯´æ˜ |
|------|------|------|
| Vector | 15 | çŠ¶æ€å‘é‡ |
| CNN Features | 256 | æ·±åº¦å›¾ç‰¹å¾ (å¯é€‰) |
| **åˆå¹¶å** | **271** | concat(15, 256) |

---

## ğŸ”µ è¾“å…¥ (Observation)

### Vector çŠ¶æ€ (15ç»´)

| ç»„ä»¶ | ç»´åº¦ | è¯´æ˜ |
|------|------|------|
| Base Velocity | 2 | åº•ç›˜çº¿é€Ÿåº¦ (v_x, v_y) |
| EE Position | 3 | æœ«ç«¯æ‰§è¡Œå™¨ç›¸å¯¹ä½ç½® |
| EE Quaternion | 4 | æœ«ç«¯æ‰§è¡Œå™¨å§¿æ€ |
| EE Velocity | 3 | æœ«ç«¯æ‰§è¡Œå™¨é€Ÿåº¦ |
| Object Position | 3 | ç›®æ ‡ç‰©ä½“ç›¸å¯¹ä½ç½® |
| **æ€»è®¡** | **15** | - |

### Depth Image (å¯é€‰)

| å±æ€§ | å€¼ |
|------|-----|
| åˆ†è¾¨ç‡ | 224Ã—224 |
| é€šé“ | 1 (æ·±åº¦) |
| ç›¸æœº | è…•éƒ¨ç›¸æœº (wrist) |

---

## ğŸŸ¢ è¾“å‡º (Action)

| ç»„ä»¶ | ç»´åº¦ | èŒƒå›´ | è¯´æ˜ |
|------|------|------|------|
| Base | 2 | Â±4 | åº•ç›˜é€Ÿåº¦æŒ‡ä»¤ |
| Arm | 6 | Â±0.05 rad | æœºæ¢°è‡‚å…³èŠ‚å¢é‡ |
| Hand | 12 | **å›ºå®šå¼ å¼€** | ä¸æ§åˆ¶ (å›ºå®šå§¿æ€) |
| **æœ‰æ•ˆç»´åº¦** | **8** | - | 2+6 |

> **æ³¨æ„**: Stage 1 æ‰‹éƒ¨å›ºå®šå¼ å¼€ï¼Œä¸å‚ä¸æ§åˆ¶

---

## ğŸŸ¡ å¥–åŠ±å‡½æ•° (å…±9é¡¹)

### æ­£å‘å¥–åŠ±

| å¥–åŠ±é¡¹ | èŒƒå›´ | å…¬å¼/æ¡ä»¶ |
|--------|------|-----------|
| **Reaching** | 0 ~ 1.0 | `1.0 * (1 - tanh(2.0 * ee_distance))` |
| **Base Approach** | 0 ~ 1.0 | `exp(-5 * (base_dist - 0.8)Â²)` æœ€ä¼˜0.8m |
| **Orientation** | 0 ~ 2.0 | `alignment^power * 2.0` (ee < 2.0mæ—¶) |
| **Touch** | 0 ~ 10.0 | æ¥è§¦æ—¶è§¦å‘ |
| **AVP** | -5 ~ +5 | Stage 2 Critic ä»·å€¼ä¼°è®¡ (å¯é€‰) |

### è´Ÿå‘æƒ©ç½š

| æƒ©ç½šé¡¹ | èŒƒå›´ | å…¬å¼/æ¡ä»¶ |
|--------|------|-----------|
| **Impact** | ~ -4*v | `-4.0 * impact_speed` |
| **Regularization** | ~ -0.1 | `-norm(ctrl) * 0.01` |
| **Collision** | -10 æˆ– 0 | å¤±è´¥ç»ˆæ­¢æ—¶ |
| **Plant Stem** | -1 ~ -20 | è¯¾ç¨‹å­¦ä¹ åŠ¨æ€è°ƒæ•´ |
| **Plant Leaf** | ~ -0.5 | `-0.5 * (1 + ee_vel)` |
| **Action Rate** | ~ -0.5 | `-norm(Î”action) * 0.05` |

---

## ğŸ† æˆåŠŸæ¡ä»¶

### Tracking ä»»åŠ¡

```
æˆåŠŸ = æœ«ç«¯æ‰§è¡Œå™¨æ¥è§¦ç›®æ ‡ + ä¿æŒæ¥è§¦ 10 æ­¥
```

| æ¡ä»¶ | é˜ˆå€¼ |
|------|------|
| æ¥è§¦åˆ¤å®š | `step_touch == True` |
| æŒç»­æ­¥æ•° | â‰¥ 10 æ­¥ |

---

## ğŸ”— AVP (ä¸å¯¹ç§°ä»·å€¼ä¼ æ’­)

Stage 1 ä½¿ç”¨é¢„è®­ç»ƒçš„ Stage 2 Critic æä¾›é¢å¤–çš„"å¯æŠ“å–æ€§"å¥–åŠ±ä¿¡å·ã€‚

### AVP é…ç½®

| å‚æ•° | å€¼ | è¯´æ˜ |
|------|-----|------|
| `enabled` | True | ä¸»å¼€å…³ |
| `lambda_start` | 0.8 | è®­ç»ƒåˆæœŸæƒé‡ |
| `lambda_end` | 0.2 | è®­ç»ƒåæœŸæƒé‡ |
| `gate_distance` | 1.5m | è·ç¦»é—¨æ§ |

### AVP å·¥ä½œåŸç†

1. æ„å»ºè™šæ‹Ÿè§‚æµ‹ (å‡è®¾å·²åˆ°è¾¾æŠ“å–å°±ä½å§¿æ€)
2. ä½¿ç”¨ Stage 2 Critic ä¼°è®¡ä»·å€¼
3. å°†ä»·å€¼ä¹˜ä»¥ Î» ä½œä¸ºé¢å¤–å¥–åŠ±

```python
avp_reward = Î» * clip(critic_value, -5, +5)
```

---

## ğŸ“ˆ è¯¾ç¨‹å­¦ä¹ 

| å‚æ•° | èµ·å§‹å€¼ | ç»“æŸå€¼ | é˜¶æ®µ |
|------|--------|--------|------|
| `collision_stem` | -1.0 | -20.0 | 0~6Mæ­¥ |
| `orient_power` | 1.0 | 4.0 | 0~6Mæ­¥ |

---

## âš™ï¸ å…³é”®é…ç½®

| é…ç½®é¡¹ | å€¼ |
|--------|-----|
| Episodeæ—¶é—´ | 2.5ç§’ |
| æ§åˆ¶é¢‘ç‡ | æ¯20ä»¿çœŸæ­¥1åŠ¨ä½œ |
| åº•ç›˜æœ€ä¼˜è·ç¦» | 0.8m |
| Horizon | 512 |
| Minibatch | 512 |

---

## ğŸ“ ä¸ Stage 2 å¯¹æ¯”

| å±æ€§ | Stage 1 (Tracking) | Stage 2 (Catching) |
|------|---------------------|---------------------|
| **åº•ç›˜** | âœ… å¯ç§»åŠ¨ | âŒ é”å®š |
| **æ‰‹éƒ¨** | âŒ å›ºå®šå¼ å¼€ | âœ… å¯æ§åˆ¶ |
| **æœ‰æ•ˆåŠ¨ä½œç»´åº¦** | 8 (2+6) | 18 (6+12) |
| **Actorè¾“å…¥** | Vector (+Imageå¯é€‰) | ä»…State (35ç»´) |
| **Criticè¾“å…¥** | ä¸Actorç›¸åŒ | State + Depth (7091ç»´) |
| **æ¶æ„ç±»å‹** | å¯¹ç§° | ä¸å¯¹ç§° |
| **AVP** | âœ… ä½¿ç”¨Stage2 Critic | âŒ ä¸ä½¿ç”¨ |
| **æˆåŠŸæ¡ä»¶** | æ¥è§¦10æ­¥ | ç¨³å®šæŠ“å–2ç§’ |
